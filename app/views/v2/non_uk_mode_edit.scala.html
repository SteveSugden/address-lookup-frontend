@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import model._
@import uk.gov.hmrc.play.views.html.helpers
@import views.html.helpers.{alfErrorSummary, alfInput, countryAutoComplete}
@import views.html.v2.main_template
@import model.MessageConstants.{EnglishMessageConstants, WelshMessageConstants, MessageConstants}
@import config.FrontendAppConfig
@import views.html.helpers.head
@import config.FooterLinks

@this(govukLayout: GovukLayout, head: head, footer: GovukFooter, banner: HmrcBanner, help: HmrcReportTechnicalIssue,
form: FormWithCSRF, textarea: govukTextarea, button: govukButton, govukBackLink: GovukBackLink,
errorSummary: GovukErrorSummary, textInput: GovukInput, languageSwitch: HmrcLanguageSelect, radios: GovukRadios)
@(id: String, journeyData: JourneyDataV2, editForm: Form[Edit], countries: Seq[(String, String)], isWelsh: Boolean, isUKMode: Boolean = false)(implicit request: Request[_], messages: Messages, appConfig: FrontendAppConfig)

@messageConstants = @{
    if(isWelsh) WelshMessageConstants(isUKMode) else EnglishMessageConstants(isUKMode)
}

@resolvedConf = @{
    journeyData.resolveConfigV2(isWelsh, appConfig)
}

@errorPrefix = @{
    if(isWelsh) "Gwall: " else "Error: "
}

@titleWithError = @{
    if(editForm.errors) {
        errorPrefix + resolvedConf.labels.editPageLabels.title
    } else {
        resolvedConf.labels.editPageLabels.title
    }
}

@scriptElem = {
    <script type="text/javascript">
            window.onpageshow = function (event) {
                $('button[disabled]').prop('disabled', false);
            };
    </script>
}

@beforeContent = {
@banner(Banner())

@if(journeyData.resolveConfigV2(isWelsh, appConfig).options.showBackButtons) {
    @govukBackLink(BackLink(href = "javascript:history.back()", content = HtmlContent(messageConstants.back)))
}

@languageSwitch(LanguageSelect(
    messages.lang.code match {
        case "en" ⇒ En
        case "cy" ⇒ Cy
    }, En -> s"${controllers.routes.LanguageController.switchToLanguage("english")}",
    Cy -> s"${controllers.routes.LanguageController.switchToLanguage("cymraeg")}"
)
)
}

@govukLayout(
    pageTitle = Some(titleWithError),
    headBlock = Some(head()),
    beforeContentBlock = Some(beforeContent),
    scriptsBlock = Some(scriptElem),
    footerBlock = Some(footer(Footer(
        meta = Some(Meta(
            visuallyHiddenTitle = Some("Support links"),
            items = Some(FooterLinks())
        ))
    )))
) {
    <div id="nonUkEdit"></div>
    @if(resolvedConf.options.showBackButtons) {
        <div>
            <a class="back-link" href="javascript:history.back()">@messageConstants.back</a>
        </div>
    }

    @alfErrorSummary(
        messageConstants.errorText, editForm
    )

    <header class="page-header">
        <h1 class="heading-xlarge" id="pageHeading">@{
            resolvedConf.labels.editPageLabels.heading
        }</h1>
    </header>

    @form(routes.AddressLookupController.handleEdit(id)) {
        <fieldset class="form-field-group">
            @textInput(Input(value = editForm("line1").value,
                label = Label(content = HtmlContent(resolvedConf.labels.editPageLabels.line1Label)),
                formGroupClasses = "form-field-group", autocomplete = Some("address-line1")))
            @textInput(Input(value = editForm("line2").value,
                label = Label(content = HtmlContent(resolvedConf.labels.editPageLabels.line2Label)),
                formGroupClasses = "form-field-group", autocomplete = Some("address-line2")))
            @textInput(Input(value = editForm("line3").value,
                label = Label(content = HtmlContent(resolvedConf.labels.editPageLabels.line3Label)),
                formGroupClasses = "form-field-group", autocomplete = Some("address-line3")))
            @textInput(Input(value = editForm("town").value,
                label = Label(content = HtmlContent(resolvedConf.labels.editPageLabels.townLabel)),
                formGroupClasses = "form-field-group", autocomplete = Some("address-level2")))
            @textInput(Input(value = editForm("postcode").value,
                label = Label(content = HtmlContent(resolvedConf.labels.editPageLabels.postcodeLabel)),
                formGroupClasses = "form-field-group", autocomplete = Some("postal-code")))

            @if(countries.size > 1) {
                <div class="form-field spaced-below">
                @countryAutoComplete(countries, editForm("countryCode"), resolvedConf.labels.editPageLabels.countryLabel)
                </div>
            } else {
                @defining(countries.head._1) { countryCode =>
                    <input type="hidden" name="countryCode" value="@countryCode"/>
                }
                @defining(countries.head._2) { countryName =>
                    <div class="form-field">
                        <label for="@countryName">
                            <span>@resolvedConf.labels.editPageLabels.countryLabel</span>
                            <input type="text" readonly="" disabled="" class="form-control--block input--medium" value="@countryName"/>
                        </label>
                    </div>
                }
            }

            @button(Button(content = HtmlContent(journeyData.resolveConfigV2(isWelsh, appConfig).labels.editPageLabels.submitLabel),
                name = Some("continue"),
                inputType = Some("submit")))
        </fieldset>
    }
}
